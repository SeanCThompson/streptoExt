#!/bin/sh

# Extract last row x col of data file

runName=$(basename $1 .txt | awk -F '[_]' '{print$2}')

tail -n 90000 $1 > ${runName}_${2}_lastframe.txt

echo ${runName}_${2}

# Find most common lineage

lineage=$(awk -F '[ ]' '{print $4}' ${runName}'_'${2}'_lastframe.txt' | awk '$1>0' | sort -n | uniq -c | sort -n -k 1 -r | head  -1 | awk '{ gsub(/^[ \t]+|[ \t]+$/, ""); print }' | awk -F '[ ]' '{print $2}')

echo $lineage

genome=$(grep ", $lineage " ${runName}'_'${2}'_lastframe.txt' | head -1 | awk '{$1=$2=$3=$4=""; print $0}')

#genome='AAAAAAAAAFFFFFFFFFFFFFFFFFFFFFAFFFFFFFFFFFFFFFFFFFFFFFFFA 38082,38018,50212,1154,34086,38082,38018,34214,50212,50214,50342, 0.001 0.8, 0.9 0.9, 1 1'
#genome='AFAFFFFAFAFFFFFFFFFFFAFFFAFFFFFAFFFFFFFFFFFAFFAFAFFFFFFFFFAFF 38082,38018,50212,1154,34086,38082,38018,34214,50214,50214,50342, 0.046222 0.811903, 0.883708 0.618599, 1 1'
#genome='AAAAAAAAAAAFFFFFFFFFFFFFFFFFFFF 38082,38018,50212,1154,34086,38082,38018,34214,50212,50214,50342, 0.001 0.8, 0.9 0.9, 1 1'
#genome='FFFFFFFFFFFAFFAFAFFFFFFFFAAFFFFFAFFFFFAFAFFFFAAAFA 47426,47939,47427,47939,47427,49006,15593,15465,48963,47939,48361,12365, 0.0104183 0.832070, 0.984682 0.737399, 1 1'



#genome='AFFFFFFAFFFFAAAAAFFAFFFFFFFFFFFFFFFFAFFAAFFFFAFAFF 17323,683,17327,939,955,955,1979,1979,41515,683,8747,11049,38350, 0.036404 0.751477, 0.671870 0.810183, 0 -21' # germline 0.01
#genome='FAFFFFFFAAAFAAFAFFFFFFFFAAFFAAAFFAAFFFAFAFAFAAAFFAFFAFFFFAFAFAFFFFFFAFAFFAAFAFAFFFFAFAAFFFAAAFAFFFAFFAFFAA 31208,63768,64792,63848,63752,31080,59672,63848,64792,59800,51464,51456,63772,49416,51456,59658,51456,59784,59800,63848,49416,51456,63848,59656,59784,63816,63848,64360,59648,59672,59658,31080,59658,57736,64588,64588,63772,26984,59656,59658,59676,59078, 0.040461 0.425987, 0.631807 0.022333' #germline 0.05
genome='FFFFAFFFFAFFFAAFFFFAFAFFFAFAFAFFFAFFFFFFFFFFAFFFFFFA 47086,39790,40814,44654,63279,65327,44654,47982,46990,39790,39790,40810, 0.039854 0.643554, 0.877536 0.982568, 1 -1' #somatic 0.01
#genome='FFAAFAAFAAAAFFAAFFFAAFAFAAFFFAAAAAAAFAFAAAAAAAAAFFAAAFAAAFAFAAAFAAFFAAFAFAFAFFAFAAFAAFAFAAAAAFFAFAFAFAAFAFFAAAFFFAAAAFFFFFFAAFAAAFFFAAAFAAAAAAAFAFFAAFAAAAAAAA 55796,37596,35472,39413,51390,51462,56252,39868,51888,51558,51390,51888,55781,51494,43678,59568,51511,61118,37628,51380,56757,55796,36027,37596,51390,55602,52278,51510,22935,51575,52468,51510,51380,39676,51492,39348,39868,55733,51888,36019,55733,51558,55729,51510,51510,55602,59568,55796,3259,51558,39349,51856,55733,55797,61118,60080,55796,52468,37628,51492,51891,51494,55733,39868,60062,61062,56244,51380,53396,56757,37596,51558,55732,51380,55741,61118,55732,56244,51492,55793,61094,22935,51888,55796,55733,37564,55733,51494,37628,39612,63925,22935,56244,51380,55733,39348,55733,51494,52404, 0.008088 0.935955, 0.948254 0.762130, 0 -131' #somatic 0.05

echo $genome



echo ${runName}_logging

../src/./strepto -name ${runName}_${2}_${4}_logging -v 1 -breakpoint_mut_type P -breakpoint_init 0 -breakprob 0 -breakpoint_inflow 0 -stressed_break $2 -ddrate 0 -maxtime 2500 -season 50001 -trans_prob_mut 0.0 -c 150 -r 150 -prob_mut_antibtype_perbit 0.0 -contact_break $3 -init_genome $genome 

#python3 correlate_ABorR_Stress.py ab_mut_log_${runName}_logging.txt

python3 correlate_ABorR_intime.py ab_mut_log_${runName}_${2}_${4}_logging.txt


